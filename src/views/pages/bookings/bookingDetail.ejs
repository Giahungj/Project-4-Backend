<style>
    /* Th√™m style cho hi·ªáu ·ª©ng ƒë·ªông */
    .card {
        opacity: 0;
        transform: translateX(6rem);
        transition: opacity 1s ease, transform 1s ease;
    }
    .card.visible {
        opacity: 1;
        transform: translateX(0);
    }
    /* C·∫£i thi·ªán giao di·ªán card */
    .card-header {
        border-radius: 0.375rem 0.375rem 0 0;
    }
    .list-group-item {
        border: none;
        border-radius: 0.25rem;
    }
    .badge {
        font-size: 1rem;
        padding: 0.5em 1em;
        border-radius: 1rem;
    }
</style>
<div id="contentArea" class="row my-2 d-flex align-items-stretch">
    <div class="col m-2 d-flex">
        <div class="card shadow-sm flex-fill">
            <div class="card-header bg-teal-700 text-white font-weight-bold text-center">
                TH√îNG TIN ƒê∆†N H·∫∏N
            </div>
            <div class="card-body">
                <% if (booking) { %>
                    <table class="table table-striped">
                        <tbody>
                            <tr>
                                <th>Tr·∫°ng th√°i:</th>
                                <td class="fw-bold <%= booking.status === 1 ? 'bg-teal-700' : booking.status === -1 ? 'bg-red-500' : booking.status === 0 ? 'bg-yellow-500' : 'bg-teal-700' %>">
                                    <%= booking.status === 1 ? 'X√°c nh·∫≠n' : booking.status === -1 ? 'H·ªßy' : booking.status === 0 ? 'ƒêang c·∫≠p nh·∫≠t' : 'ƒê√£ kh√°m xong' %>
                                    <i class="fas fa-info-circle text-teal-600 ms-2" style="cursor: pointer;" data-bs-toggle="modal" data-bs-target="#reasonModal"></i>
                                </td>
                            </tr>
                            <tr><th>Ng√†y kh√°m:</th><td><%= booking.date %></td></tr>
                            <tr><th>Th·ªùi gian:</th><td><%= booking.Schedule.Timeslot.startTime %> - <%= booking.Schedule.Timeslot.endTime %></td></tr>
                            <tr><th>Ca:</th><td><%= booking.shift %></td></tr>
                            <tr><th>B√°c sƒ©:</th><td><%= booking.Schedule.Doctor.User.name %></td></tr>
                            <tr>
                                <th>B·ªánh nh√¢n:</th>
                                <td>
                                    <%= booking.Patient.User.name %> 
                                    <i class="fas fa-info-circle text-teal-600 ms-2" style="cursor: pointer;" data-bs-toggle="modal" data-bs-target="#patientDescriptionModal"></i>
                                </td>
                            </tr>
                            <tr><th>Ng√†y ƒë·∫∑t:</th><td><%= booking.createdAt %></td></tr>
                            <tr><th>Ng√†y ch·ªânh s·ª≠a:</th><td><%= booking.updatedAt %></td></tr>
                        </tbody>
                    </table>
                    <div class="text-center mt-3">
                        <button class="btn btn-danger">H·ªßy l·ªãch</button>
                        <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#changeScheduleModal">ƒê·ªïi l·ªãch</button>
                    </div>
                <% } else { %>
                    <p class="text-center text-muted">Kh√¥ng c√≥ th√¥ng tin l·ªãch</p>
                <% } %>
            </div>
        </div>
    </div>
    <div class="col m-2 d-flex">
        <div class="card shadow-sm flex-fill">
            <div class="card-header bg-teal-700 text-white font-weight-bold text-center">
                NG∆Ø·ªúI KH√ÅM
            </div>
            <div class="card-body">
                <% if (booking.Schedule.Doctor.User) { %>
                    <table class="table table-striped mt-3">
                        <tbody>
                            <tr><th>B√°c sƒ©:</th><td><%= booking.Schedule.Doctor.User.name %></td></tr>
                            <tr><th>Chuy√™n khoa:</th><td><%= booking.Schedule.Doctor.Specialty.name %></td></tr>
                            <tr><th>Li√™n h·ªá:</th><td id="doctorEmail"><%= booking.Schedule.Doctor.User.email %><button class="btn btn-sm" onclick="copyEmail()"><i class="fa-regular fa-clone"></i></button></td></tr>
                            <tr><th>ƒêi·ªán tho·∫°i:</th><td id="doctorPhone"><%= booking.Schedule.Doctor.User.phone %><button class="btn btn-sm" onclick="copyPhone()"><i class="fa-regular fa-clone"></i></button></td></tr>
                            <tr><th>C∆° s·ªü y t·∫ø:</th><td><%= booking.Schedule.Doctor.Facility.name %></td></tr>
                            <tr><th>Gi√° kh√°m:</th><td class="fw-bold text-danger"><%= booking.price %></td></tr>
                        </tbody>
                    </table>
                    <div class="text-center mt-3">
                        <button class="btn btn-info text-white" data-bs-toggle="modal" data-bs-target="#doctorProfileModal">Xem h·ªì s∆° b√°c sƒ©</button>
                    </div>
                <% } else { %>
                    <p class="text-center text-muted">Kh√¥ng c√≥ th√¥ng tin t√†i kho·∫£n</p>
                <% } %>
            </div>
        </div>
    </div>

    <div class="col m-2 d-flex">
        <div class="card shadow-sm flex-fill">
            <div class="card-header bg-teal-700 text-white font-weight-bold text-center">
                TH√îNG TIN ƒê∆†N THU·ªêC
            </div>
            <div class="card-body">
                <% if (booking.Prescriptions && booking.Prescriptions.length > 0) { %>
                    <table class="table table-bordered table-striped">
                        <thead class="table-light">
                            <tr>
                                <th class="text-center">T√™n thu·ªëc</th>
                                <th class="text-center">S·ªë l∆∞·ª£ng</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% booking.Prescriptions.forEach((pres, index) => { %>
                                <tr>
                                    <td><%= pres.Medicine.name %></td>
                                    <td class="text-center"><%= pres.quantity %></td>
                                </tr>
                            <% }) %>
                        </tbody>
                    </table>
                <% } else { %>
                    <p class="text-center text-muted fst-italic">Kh√¥ng c√≥ th√¥ng tin thu·ªëc.</p>
                <% } %>
            </div>
        </div>
    </div>
</div>

<!-- Modal ƒê·ªïi L·ªãch -->
<div class="modal fade" id="changeScheduleModal" tabindex="-1" aria-labelledby="changeScheduleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="changeScheduleModalLabel">Quy t·∫Øc ƒë·ªïi l·ªãch h·∫πn</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <ul class="list-group">
                            <li class="list-group-item">üìå ƒêi·ªÅu ki·ªán:
                                <ul>
                                    <li>L·ªãch h·∫πn b·ªã l·ªói h·ªá th·ªëng ho·∫∑c do sai s√≥t khi ƒë·∫∑t l·ªãch.</li>
                                    <li>Y√™u c·∫ßu t·ª´ b·ªánh nh√¢n ho·∫∑c b√°c sƒ© nh∆∞ng c·∫ßn s·ª± can thi·ªáp c·ªßa admin.</li>
                                    <li>H·ªá th·ªëng c·∫ßn ƒëi·ªÅu ch·ªânh l·∫°i l·ªãch ƒë·ªÉ t·ªëi ∆∞u h√≥a qu·∫£n l√Ω.</li>
                                </ul>
                            </li>
                            <li class="list-group-item">‚úÖ Tr∆∞·ªùng h·ª£p h·ª£p l·ªá:
                                <ul>
                                    <li>L·ªãch b·ªã ghi nh·∫ßm ho·∫∑c l·ªói h·ªá th·ªëng.</li>
                                    <li>B√°c sƒ© ho·∫∑c b·ªánh nh√¢n kh√¥ng th·ªÉ t·ª± thao t√°c ƒë·ªïi l·ªãch.</li>
                                    <li>C√≥ s·ª± c·ªë ph√°t sinh l√†m ·∫£nh h∆∞·ªüng ƒë·∫øn l·ªãch h·∫πn (v√≠ d·ª•: ph√≤ng kh√°m t·∫°m ƒë√≥ng c·ª≠a).</li>
                                </ul>
                            </li>
                            <li class="list-group-item">‚õî Kh√¥ng ƒë∆∞·ª£c ƒë·ªïi l·ªãch n·∫øu:
                                <ul>
                                    <li>Kh√¥ng c√≥ s·ª± ƒë·ªìng thu·∫≠n gi·ªØa c√°c b√™n li√™n quan.</li>
                                    <li>L·ªãch ƒë√£ ho√†n th√†nh ho·∫∑c s·∫Øp di·ªÖn ra trong th·ªùi gian qu√° ng·∫Øn.</li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <form>
                            <div class="mb-3">
                                <label for="newDate" class="form-label">Ng√†y m·ªõi</label>
                                <input type="date" class="form-control" id="newDate">
                            </div>
                            <div class="mb-3">
                                <label for="newTime" class="form-label">Th·ªùi gian m·ªõi</label>
                                <input type="time" class="form-control" id="newTime">
                            </div>
                            <div class="mb-3">
                                <label for="reason" class="form-label">L√Ω do ƒë·ªïi l·ªãch</label>
                                <textarea class="form-control" id="reason" rows="3"></textarea>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">ƒê√≥ng</button>
                <button type="button" class="btn btn-primary rounded-pill">Ti·∫øp t·ª•c ƒë·ªïi l·ªãch</button>
            </div>
        </div>
    </div>
</div>

<%- include('../../partials/bookings/doctorProfileModal') %>

<!-- Modal hi·ªÉn th·ªã m√¥ t·∫£ b·ªánh -->
<div class="modal fade" id="patientDescriptionModal" tabindex="-1" aria-labelledby="patientDescriptionModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="patientDescriptionModalLabel">M√¥ t·∫£ b·ªánh c·ªßa b·ªánh nh√¢n</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <% if (booking.description) { %>
                    <p><%= booking.description %></p>
                <% } else { %>
                    <p class="text-muted fst-italic">Kh√¥ng c√≥ l√Ω do</p>
                <% } %>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">ƒê√≥ng</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal L√Ω Do -->
<div class="modal fade" id="reasonModal" tabindex="-1" aria-labelledby="reasonModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reasonModalLabel">Ghi ch√∫</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <% if (!booking.History.id) { %>
                    <p class="text-muted fst-italic">Kh√¥ng c√≥ th√¥ng tin v·ªÅ l·ªãch s·ª≠</p>
                <% } else { %>
                    <p>Ghi ch√∫: <%= booking.History.diagnosis === '' ? 'Kh√¥ng c√≥ ghi ch√∫' : booking.History.diagnosis %></p>
                    <p>Ng√†y t√°i kh√°m: <%= !booking.History.revisitDate ? 'Kh√¥ng t√°i kh√°m' : '20/5/2025' %></p>
                    <p>Chu·∫©n ƒëo√°n c·ªßa b√°c sƒ©: <%= booking.History.conditionAssessment %></p>
                <% } %>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">ƒê√≥ng</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Th√™m class 'visible' cho t·ª´ng card v·ªõi ƒë·ªô tr·ªÖ ƒë·ªÉ t·∫°o hi·ªáu ·ª©ng tu·∫ßn t·ª±
    document.addEventListener('DOMContentLoaded', () => {
        const cards = document.querySelectorAll('.card');
        cards.forEach((card, index) => {
            setTimeout(() => {
                card.classList.add('visible');
            }, index * 100); // ƒê·ªô tr·ªÖ 200ms gi·ªØa m·ªói card
        });
    });

    function copyEmail() {
        let emailText = document.getElementById("doctorEmail").innerText;
        navigator.clipboard.writeText(emailText).then(() => {
            alert("Email ƒë√£ ƒë∆∞·ª£c sao ch√©p!");
        }).catch(err => {
            console.error("Kh√¥ng th·ªÉ sao ch√©p email", err);
        });
    }
    function copyPhone() {
        let phoneText = document.getElementById("doctorPhone").innerText;
        navigator.clipboard.writeText(phoneText).then(() => {
            alert("S·ªë ƒëi·ªán tho·∫°i ƒë√£ ƒë∆∞·ª£c sao ch√©p!");
        }).catch(err => {
            console.error("Kh√¥ng th·ªÉ sao ch√©p s·ªë ƒëi·ªán tho·∫°i", err);
        });
    }
</script>